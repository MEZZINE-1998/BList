node {
   stage('Get Source from Github') {
      // copy source code from local file system and test
      // for a Dockerfile to build the Docker image
      git ('https://github.com/MEZZINE-1998/Flask-web-app-IHM-with-CI-CD-pipeline-.git')
      if (!fileExists("dockerfile")) {
         error('dockerfile missing.')
      }
   }
   
   stage('Build Docker image') {
       // build the docker image from the source code using the BUILD_ID parameter in image name
       sh 'docker build -t mezzine/blist .'
       // app = docker.build("mezzine/blist")
   }
   
   stage('Push image to Docker Hub'){
      // docker.withRegistry('https://registry.hub.docker.com', '59465104-1eb9-4aa6-b434-045ca8244670') {            
      //   app.push("${env.BUILD_NUMBER}")            
      //   app.push("latest")        
      //}
      withCredentials([string(credentialsId: 'Dockerhub', variable: 'dockerhubpsswd')]) {
         sh "docker login -u mezzine -p ${dockerhubpsswd}"
      }
      sh 'docker push mezzine/blist'
   }
   
   stage("Deploy the App on minikube-K8S"){
        sh 'kubectl apply -f k8sfile.yaml'
   }
}
